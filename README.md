# QED for Unix, UTF8/Unicode aware.

This is a port of the University of Toronto Unix version of the QED editor,
which was originally written by Rob Pike, David Tilbrook, Hugh
Redelmeier and Tom Duff. I have updated it to work with UTF8 and Unicode.

The behaviour of this `qed` when displaying Unicode is entirely dependent on the
capabilities of the terminal it is running under. In particular, `qed` 
outputs Unicode in Logical Order, leaving the handling of the
complexities of rendering bi-directional text and wide-characters on-screen
to the terminal. On macOS, the `Terminal.app` program is quite successful with
displaying bi-directional text, whereas `xterm` on Linux sticks to
Logical Order.

This port was developed on a modern Linux (Fedora 32), and macOS. It
depends on just a few low-level Unix system calls, so should be reasonably
portable across any Unix-like OS. I have built this `qed` successfully on:

+  Linux (Fedora 32, `gcc`)
+  macOS Intel (Catalina 10.15 with Commandline Developer Tools, `clang`)
+  macOS Apple Silicon (Big Sur 11.2 with Commandline Developer Tools, `clang`)
+  OpenBSD (6.7, both `gcc` and `clang`)

The sources that this port began with were scavenged from Arnold Robbins's
[qed-archive](https://github.com/arnoldrobbins/qed-archive). Specifically
they are from the `unix-1992` sub-directory, which is from a tarball
of Rob Pike's original sources of the University of Toronto version of QED.

The manpage and tutorial in the `doc` subdirectory are essential reading.
Rob Pike's original tutorial is in `doc/historical`, along with a
`pdf` run-off. `doc/tutorial.md` is an edited an updated version of the
tutorial. `doc/tutorial.html` is generated by invoking `make tutorial`. It
depends on having a `markdown` in your path.

Unlike the original tutorial, the manpage is reasonably up-to-date, but
where the behaviour of this `qed` differs
significantly from the manpage is noted below.

The `Makefile` provides a simple way to build a `qed` binary.
`make clean && make` will build a fully stand-alone binary `qed`, which
can be installed anywhere. `make install` will install the binary and
the manpage. Edit the `Makefile` to change where this all goes.

The `doc/historical/read.me` file is Rob Pike's, accompanying his original tarball. It
provides an interesting snapshot into the work-in-progress at the time, and the
relationship between the QED and ED editors.

The `q` subdirectory contains Rob's library of useful QED programs. Again
a master-class in themselves, and they can be fruitfully studied after working
through the tutorial.

## Differences introduced in this port

+ This `qed` consumes and outputs UTF8 Unicode. Internally, all
  "characters" are stored and manipulated as Unicode code-points
  represented as `int`-s. The full Unicode range is supported,
  thus even _emojis_ and other exotica beyond the BMP can appear,
  even in regexes. 

+ In *list mode*, this `qed` displays non-printing codepoints in the
  ASCII range as `\xhh`. Additionally, it displays non-ASCII
  code-points in the Basic Multilingual Plane as `\uhhhh`, and
  code-points beyond the BMP as `\Uhhhhhh`.

+ This `qed` adds the special characters `\x`, `\u`, `\U` which
  can be used to enter (valid) Unicode codepoints directly, using 
  (lowercase) hexadecimal. For example `\x53`, will insert
  ASCII `0x53` (`S`); `\u05d0` will insert Hebrew Aleph (`◊ê`); and
  `\U01f600` will insert a grinning _emoji_ (`üòÄ`). The format
  corresponds to the new *list mode* format described above.
  If the wrong number of digits is supplied, or the resulting
  codepoint falls outside the legitimate range, this `qed` generates
  a `?U` error.

+ The program `qedbufs` referred to in the manpage is not ported,
  and likely won't be.

+ When reading in a file which does not terminate in a newline, this
  `qed` supplies the newline, and notifies the user with the message
  `?N: appended`. This matches the Research Unix Version 10 `ed` and
  the Plan9 `ed` behaviour. Previously
  QED would throw an `?N` error, and discard any input from the last
  newline to the end of file.

## Differences from the manpage already apparent in the original sources

+ When reading in files given on the commandline, this `qed` reports
  the buffer name, `dol` (_i.e._ line count), and filename of each. The
  QED in the original tutorial and manpage simply reports a character count in
  this case.

